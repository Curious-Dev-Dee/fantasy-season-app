<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cricket Experts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <link rel="stylesheet" href="css/home.css" />
  <link rel="stylesheet" href="css/bottom-nav.css" />
  
  <script type="module" src="auth-guard.js"></script>

  <style>
    /* SENIOR DEV PATTERN: State-Based Visibility */
    
    /* State 1: LOADING (Body has 'loading-state') */
    body.loading-state .app-container {
      display: none; /* Hide the app while checking auth */
    }
    
    body.loading-state #loadingOverlay {
      display: flex; /* Show the spinner */
    }

    /* State 2: LOADED (Body does NOT have 'loading-state') */
    body .app-container {
      display: block;
      animation: fadeIn 0.4s ease-out;
    }

    body #loadingOverlay {
      display: none; /* Hide spinner when done */
    }

    /* Standard Styles */
    #loadingOverlay {
      position: fixed; 
      inset: 0; 
      background: #0c1117;
      display: flex; 
      align-items: center; 
      justify-content: center; 
      z-index: 999;
    }
    
    .spinner {
      width: 40px; 
      height: 40px; 
      border: 4px solid rgba(154, 224, 0, 0.1);
      border-left-color: #9AE000; 
      border-radius: 50%; 
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* View All Button Styling */
    .view-all-btn {
      width: 100%;
      background: transparent;
      border: 1px solid rgba(154, 224, 0, 0.2);
      color: #9AE000;
      padding: 12px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s ease;
    }

    .view-all-btn:hover {
      background: rgba(154, 224, 0, 0.05);
      border-color: #9AE000;
    }
    
    /* Utility to hide elements (used by logic scripts) */
    .hidden { display: none !important; }
  </style>
</head>

<body class="loading-state">

<div id="loadingOverlay">
  <div class="spinner"></div>
</div>

<div class="app-container page-with-nav">
  
  <header class="app-header">
    <h1 id="tournamentName">Tournament</h1>
  </header>

  <section class="card user-card">
    <div class="user-info">
      <div class="team-avatar" id="teamAvatar"></div>
      <div>
        <p class="welcome-text" id="welcomeText">Welcome back, Expert</p>
        <p class="team-subtitle" id="userTeamName">Set your team name</p>
      </div>
    </div>
  </section>

  <section class="card stats-card">
    <div class="stat-inline">
      <span class="stat-icon">üìà</span>
      <span class="stat-label">Score:</span>
      <span class="stat-value" id="userScore">0</span>
    </div>
    <div class="divider"></div>
    <div class="stat-inline">
      <span class="stat-icon">üèÜ</span>
      <span class="stat-label">Rank:</span>
      <span class="stat-value highlight" id="userRank">‚Äî</span>
    </div>
    <div class="divider"></div>
    <div class="stat-inline">
      <span class="stat-icon">üîÑ</span>
      <span class="stat-label">Subs:</span>
      <span class="stat-value" id="subsRemaining">80</span>
    </div>
  </section>

  <section class="card next-match-card">
    <p class="section-label">Upcoming Match</p>
    <h3 class="match-teams" id="matchTeams">‚Äî</h3>
    <p class="match-time" id="matchTime">Loading match...</p>
    <div class="match-actions">
      <button class="secondary-btn" id="viewXiBtn">View Team</button>
      <button class="primary-btn" id="editXiBtn">Change</button>
    </div>
    <div class="btn-hint">Edit your XI before match lock</div>
  </section>

  <section class="card leaderboard-card">
    <h3>Top Experts</h3>
    <div id="leaderboardContainer">
      <p style="color: #9ca3af; font-size: 13px;">Updating rankings...</p>
    </div>
    <button class="view-all-btn" id="viewFullLeaderboard">
      View Full Leaderboard <span>‚Ä∫</span>
    </button>
  </section>

</div>

<div id="profileModal" class="modal hidden">
  <div class="modal-content">
    <h2>Complete Profile</h2>
    
    <div class="upload-preview-container">
    <div id="modalAvatarPreview"></div>
    
    <label for="avatarInput" class="edit-icon-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
        </svg>
    </label>
    
    <input type="file" id="avatarInput" accept="image/*" class="hidden" />
</div>

    <label for="modalFullName">Your Name</label>
    <input type="text" id="modalFullName" placeholder="e.g. MS Dhoni" />
    
    <label for="modalTeamName">Team Name</label>
    <input type="text" id="modalTeamName" placeholder="e.g. AvengersCTC" />
    
    <button id="saveProfileBtn" class="primary-btn full-width">Save & Start</button>
  </div>
</div>

<nav class="bottom-nav">
  <a href="/home" class="active">Home</a>
  <a href="/fixtures">Fixtures</a>
  <a href="/prediction">Prediction</a>
  <a href="/more">More</a>
</nav>

<script type="module" src="home.js"></script>

</body>
</html>